<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!-- Viewport for mobile -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MSN Messenger Chat</title>
  <style>
    /* =====================================
       Root & Reset
       ===================================== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: Tahoma, Arial, sans-serif;
    }

    html, body {
      height: 100%;
      width: 100%;
      background: #dfe7f2;
      color: #000;
    }

    body.light {
      /* Light mode */
      --bg-gradient: linear-gradient(to bottom, #ffffff, #dfe7f2);
      --header-bg: #cfe6ff;
      --chat-bg: #ffffff;
      --bubble-bg-left: #e7f7df;
      --bubble-bg-right: #e1efff;
      --footer-bg: #f0c0db;
      --text-color: #000;
      --scrollbar-color: #c8c8c8;
    }

    body.dark {
      /* Dark mode: subtle gradients of dark grey */
      --bg-gradient: linear-gradient(to bottom, #2c2c2c, #3a3a3a);
      --header-bg: #444;
      --chat-bg: #2f2f2f;
      --bubble-bg-left: #4b4f48;
      --bubble-bg-right: #4a4e63;
      --footer-bg: #555;
      --text-color: #eee;
      --scrollbar-color: #666;
    }

    body {
      background: var(--bg-gradient);
      transition: background 0.3s;
    }

    /* =====================================
       Messenger Container
       ===================================== */
    .messenger {
      width: 95%;
      max-width: 650px;
      height: 90%;
      max-height: 850px;
      background: var(--chat-bg);
      border: 2px solid #d3d3d3;
      border-radius: 5px;
      display: flex;
      flex-direction: column;
      position: relative;
      margin: auto;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      overflow: hidden;
    }

    /* Shake animation for nudge */
    @keyframes shake {
      0% { transform: translate(0,0); }
      20% { transform: translate(-5px,0); }
      40% { transform: translate(5px,0); }
      60% { transform: translate(-5px,0); }
      80% { transform: translate(5px,0); }
      100% { transform: translate(0,0); }
    }

    .messenger.nudging {
      animation: shake 0.4s;
    }

    /* =====================================
       Header
       ===================================== */
    .header {
      background: var(--header-bg);
      display: flex;
      align-items: center;
      padding: 5px 10px;
      height: 40px;
      color: var(--text-color);
      font-size: 12px;
      border-bottom: 1px solid #999;
    }

    .header .title {
      flex: 1;
      font-weight: bold;
    }

    .header .controls {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .status {
      font-size: 12px;
      margin-right: 5px;
    }

    /* Buttons */
    .btn {
      background: linear-gradient(to bottom, #ededed, #d2d2d2);
      border: 1px solid #999;
      border-radius: 3px;
      color: #000;
      font-size: 12px;
      padding: 2px 5px;
      cursor: pointer;
      box-shadow: inset 0 1px #fff;
    }
    .btn:hover {
      background: linear-gradient(to bottom, #f1f1f1, #c9c9c9);
    }

    .theme-toggle, .nudge-btn {
      background: linear-gradient(to bottom, #e0f0ff, #b0d4f1);
      border: 1px solid #888;
      color: #000;
      padding: 2px 6px;
      font-size: 12px;
    }

    .theme-toggle:hover, .nudge-btn:hover {
      background: linear-gradient(to bottom, #f1f9ff, #9ec7e1);
    }

    /* =====================================
       Chat Area
       ===================================== */
    .chat {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
      position: relative;
      color: var(--text-color);
      scrollbar-width: thin;
      scrollbar-color: var(--scrollbar-color) transparent;
    }

    .chat::-webkit-scrollbar {
      width: 10px;
    }
    .chat::-webkit-scrollbar-thumb {
      background: var(--scrollbar-color);
      border-radius: 5px;
    }

    .message {
      display: flex;
      align-items: flex-start;
      margin-bottom: 10px;
      font-size: 12px;
    }

    .message.david {
      justify-content: flex-start;
    }
    .message.jacko {
      justify-content: flex-end;
    }

    .message .avatar {
      width: 32px;
      height: 32px;
      border-radius: 3px;
    }

    .message.david .bubble {
      background: var(--bubble-bg-left);
      color: var(--text-color);
      margin-left: 5px;
      border: 1px solid #aaa;
      border-radius: 5px;
      padding: 5px 8px;
      max-width: 60%;
    }

    .message.jacko .bubble {
      background: var(--bubble-bg-right);
      color: var(--text-color);
      margin-right: 5px;
      border: 1px solid #aaa;
      border-radius: 5px;
      padding: 5px 8px;
      max-width: 60%;
    }

    .message.david .bubble::after,
    .message.jacko .bubble::after {
      content: '';
      display: block;
      clear: both;
    }

    .typing-indicator {
      font-style: italic;
      opacity: 0.8;
    }

    /* Nudge message style */
    .nudge-info {
      color: #333;
      font-size: 11px;
      font-style: italic;
      margin-bottom: 5px;
    }

    /* =====================================
       Footer
       ===================================== */
    .footer {
      background: var(--footer-bg);
      padding: 5px;
      display: flex;
      align-items: center;
      gap: 5px;
      position: relative;
    }

    .footer .icon-btn {
      width: 24px;
      height: 24px;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 2px;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .footer .icon-btn:hover {
      border-color: #999;
    }

    .footer input[type="text"] {
      flex: 1;
      padding: 5px;
      font-size: 12px;
      border: 1px solid #ccc;
      border-radius: 3px;
    }

    .footer .send-btn {
      background: #0078d7;
      border: none;
      border-radius: 3px;
      padding: 5px 8px;
      color: #fff;
      font-size: 12px;
      cursor: pointer;
    }

    .footer .send-btn:hover {
      background: #0056a4;
    }

    /* =====================================
       Pop-up Panels (Emoticons & Attach)
       ===================================== */
    .popup {
      position: absolute;
      bottom: 40px;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 3px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      padding: 5px;
      display: none;
      z-index: 10;
    }

    .popup img {
      width: 24px;
      height: 24px;
      margin: 3px;
      cursor: pointer;
      vertical-align: middle;
    }

    .popup img:hover {
      outline: 1px solid #0078d7;
    }

    /* Emoticons should appear inline at about text height */
    .emoticon {
      width: 16px;
      height: 16px;
      vertical-align: text-bottom;
    }

    @media (max-width: 600px) {
      .footer {
        position: fixed;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 100%;
        max-width: 650px;
      }
      .messenger {
        height: 100%;
        max-height: none;
        border-radius: 0;
      }
    }
  </style>
</head>
<body class="light">
  <div class="messenger" id="messenger">
    <div class="header">
      <button class="btn" onclick="goBack()">Back</button>
      <div class="title">MSN Messenger - Chatting with David (davelew100@hotmail.com)</div>
      <div class="controls">
        <div class="status" id="status">Online</div>
        <button class="nudge-btn" onclick="nudge()">Nudge</button>
        <button class="theme-toggle" onclick="toggleTheme()">Toggle Theme</button>
      </div>
    </div>

    <div class="chat" id="chat"></div>

    <div class="footer">
      <div class="icon-btn" title="Emoticons" onclick="togglePopup('emoticonPopup')">ðŸ˜Š</div>
      <div class="icon-btn" title="Attach" onclick="togglePopup('attachPopup')">ðŸ“Ž</div>
      <input type="text" id="messageInput" placeholder="Type a message..." onkeydown="handleKeyDown(event)">
      <button class="send-btn" onclick="sendMessage()">Send</button>
    </div>

    <!-- Emoticon Popup -->
    <div class="popup" id="emoticonPopup">
      <!-- Example emoticons (use your own URLs or local images) -->
      <img src="emoticons/smile.png" alt=":)" onclick="insertEmoticon(this)">
      <img src="emoticons/wink.png" alt=";)" onclick="insertEmoticon(this)">
      <img src="emoticons/tongue.png" alt=":P" onclick="insertEmoticon(this)">
      <img src="emoticons/cry.png" alt=":(" onclick="insertEmoticon(this)">
      <img src="emoticons/heart.png" alt="<3" onclick="insertEmoticon(this)">
      <img src="emoticons/cool.png" alt="B)" onclick="insertEmoticon(this)">
    </div>

    <!-- Attach Popup -->
    <div class="popup" id="attachPopup">
      <!-- 6 clipart images -->
      <img src="clipart/clip1.png" onclick="sendAttachedImage('clipart/clip1.png')">
      <img src="clipart/clip2.png" onclick="sendAttachedImage('clipart/clip2.png')">
      <img src="clipart/clip3.png" onclick="sendAttachedImage('clipart/clip3.png')">
      <img src="clipart/clip4.png" onclick="sendAttachedImage('clipart/clip4.png')">
      <img src="clipart/clip5.png" onclick="sendAttachedImage('clipart/clip5.png')">
      <img src="clipart/clip6.png" onclick="sendAttachedImage('clipart/clip6.png')">
    </div>
  </div>

  <audio id="nudgeSound" src="nudge.mp3" preload="auto"></audio>

  <script>
    let isDarkMode = false;

    function goBack() {
      window.location.href = 'index.html';
    }

    function toggleTheme() {
      isDarkMode = !isDarkMode;
      if (isDarkMode) {
        document.body.classList.remove('light');
        document.body.classList.add('dark');
      } else {
        document.body.classList.remove('dark');
        document.body.classList.add('light');
      }
    }

    const chat = document.getElementById('chat');
    const messageInput = document.getElementById('messageInput');
    const messenger = document.getElementById('messenger');

    const statusOptions = ["Online", "Away", "Busy"];
    function updateStatus() {
      const prev = document.getElementById('status').innerText;
      let newStatus = prev;
      while (newStatus === prev) {
        newStatus = statusOptions[Math.floor(Math.random() * statusOptions.length)];
      }
      document.getElementById('status').innerText = newStatus;
    }
    setInterval(updateStatus, 30000);

    /* 
       David's responses:
       We'll create a few categories of responses:
       - greetings
       - questions
       - nudges
       - general statements
       We'll pick from these based on simple heuristics.
       
       Context from the prompt: David is 15 (in 2007), lives in Scunthorpe ("Sunny Scunny"),
       references MySpace, friends, school (Frederick Gough School), topman fashion, flash animations,
       local characters, and subtle British references. Light swearing is allowed (mild British cursewords).
    */
    const greetings = [
      "Ey up, you alright? Itâ€™s David here in Sunny Scunny.",
      "Oh hey, didnâ€™t see you pop up there. Whatâ€™s happening?",
      "Hiya, just messinâ€™ about on MySpace. You good?",
      "Oh hello, just got back from Cenny Park. Sup?"
    ];

    const questionsResp = [
      "Thatâ€™s a weird one, mate. Maybe ask Lakey, heâ€™s still stuck inside playing Neopets.",
      "Huh, not sure. Could check with Ben, heâ€™s proper off one about that on MySpace.",
      "Good question. Might have to ask Paskyâ€™s dad at the meat packing plant, he knows random stuff.",
      "Iâ€™d guess around May 15th 2007 here in Sunny Scunny, but what do I know?",
      "Dunno, might depend on if the Riddz Cru are out on the ten-foot. Theyâ€™re always up to something.",
      "Ask Miss Newsum in Drama, sheâ€™ll probably wig out about it anyway.",
      "Not sure, mate. Last time I asked something like that, Spanner just grunted and spat on the pavement."
    ];

    const nudgesResp = [
      "Oi, stop nudging me! Iâ€™m not your Tamagotchi.",
      "Nudge received. Cheers, I guess.",
      "Bloody hell, stop with the nudges, Iâ€™m trying to sort my Top 8.",
      "Alright alright, I felt thatâ€¦ you trying to be the Riddz Cru or summat?",
      "Ah mate, nudges remind me of Spanner tapping on my window back in Riddings.",
      "Fine, I felt your nudge. Carry on, Iâ€™m not bothered."
    ];

    const generalResp = [
      "Just tweaked my MySpace layout again, topman skinny jeans vibes, innit.",
      "Saw Pasky the other day, heâ€™s still stuck in that caravan on his parentâ€™s driveway. Net Nanny and all.",
      "Spent last night drawing on my tablet, working on â€˜General Cheddarâ€™s Cheese Factoryâ€™ flash animation.",
      "Remember Lakey? Heâ€™s basically married to his WoW account, never see him now.",
      "At Frederick Gough School today, under the bridge (which ainâ€™t a bridge), Carl Frow kicked off again.",
      "I used to live down Riddings, slapped spicy TNT cheese on a wall to freak out the chav lads.",
      "Benâ€™s MySpace name changed again, something like â€˜Ben? Who the fuck is Ben?â€™. Edgy.",
      "Might head to Cenny Park later, take some photos with my Sony Ericsson for MySpace.",
      "Mrs Jeans Captainâ€™s form is bigging us up again like weâ€™re the coolest at school. Cringe.",
      "I remember making a flash cartoon with my mumâ€™s voice as a lemon saying â€˜hello, how are you?â€™ - classic.",
      "Just tried some new indie tunes I found on MySpace, Kate Nash vibes.",
      "Reading NME magazine and thinking about making a nu-rave themed background for my profile.",
      "Siana reckons Matthew Slee is stirring up drama again. Typical.",
      "Had a weird flashback to the Riddz Cru days, me making random bottle sculptures with a hot glue gun.",
      "Took some photos of Jacob Whitesideâ€™s graffiti. Proper edgy stuff, might whack it on MySpace.",
      "NMEâ€™s got this new band Iâ€™m into. Gonna show Joe Coult, heâ€™s mad about heavy metal though.",
      "Skins was on TV last night, gave me some ideas for a new flash parody.",
      "I saw Fran and Sophie at school, they laughed at my old flash cartoons. I donâ€™t blame them.",
      "Thinking about making a new weird song like â€˜happy pineconeâ€™ but Iâ€™m older now, less cringeâ€¦ maybe.",
      "Under the bridge at dinner break, Todd Downing was roaring like a feral kid again.",
      "Saw Carl Frow in his leather duster on non-uniform day, absolute madness.",
      "Might upload some random photos from my K750i to MySpace, show off me and Jacko messing about.",
      "I was once doodling wombat superhero in flash, might revisit that idea.",
      "Cheese is hilarious, right? Thatâ€™s why I called it â€˜General Cheddarâ€™s Cheese Factoryâ€™.",
      "Got some GCSE Graphic Design homework due, might just draw something random and edgy.",
      "Scunnyâ€™s looking bright today, or as bright as Scunny gets.",
      "Might wander down to Riddings later, see if Riddz Cru are still lurking in baby blue tracksuits.",
      "I asked Paskyâ€™s dad about ham once, he went on about how he packed it in a plant near Paris.",
      "Just saw Jacko with Sophie Eyre, theyâ€™re cute together, might annoy them with my camera.",
      "Simeon popped by earlier, whispered something about a bible verse, wholesome but awkward.",
      "Ben Graingerâ€™s profile song changed again, some obscure indie band from Sheffield.",
      "Might do some random flash animations again, got nostalgic about my old â€˜Iâ€™m a doctor I can helpâ€™ gag.",
      "Miss Newsum was chill today, only wigged out about a pencil missing. Drama, eh?",
      "If you ask me what day it is, Iâ€™ll say itâ€™s 2007 and thatâ€™s all that matters."
    ];

    // Simple logic to pick response category
    function getDavidResponse(userMsg, isNudge = false) {
      if (isNudge) {
        return nudgesResp[Math.floor(Math.random() * nudgesResp.length)];
      }

      // Check if greeting
      const userMsgLower = userMsg.toLowerCase();
      if (userMsgLower.includes("hi") || userMsgLower.includes("hello") || userMsgLower.includes("hey")) {
        return greetings[Math.floor(Math.random() * greetings.length)];
      }

      // Check if question
      if (userMsg.trim().endsWith("?")) {
        return questionsResp[Math.floor(Math.random() * questionsResp.length)];
      }

      // Otherwise general
      return generalResp[Math.floor(Math.random() * generalResp.length)];
    }

    function sendMessage() {
      const msg = messageInput.value.trim();
      if (!msg) return;

      addMessage('jacko', 'jacko.png', msg);
      messageInput.value = '';
      autoScroll();

      showTypingIndicator();
      setTimeout(() => {
        hideTypingIndicator();
        const reply = getDavidResponse(msg);
        addMessage('david', 'david.png', reply);
        autoScroll();
      }, 2000);
    }

    function addMessage(user, avatar, text, isImage = false) {
      const messageDiv = document.createElement('div');
      messageDiv.classList.add('message', user);

      const img = document.createElement('img');
      img.classList.add('avatar');
      img.src = avatar;
      img.alt = user.charAt(0).toUpperCase() + user.slice(1);

      const bubble = document.createElement('div');
      bubble.classList.add('bubble');
      if (isImage) {
        bubble.innerHTML = `<img src="${text}" style="max-width:100px;">`;
      } else {
        bubble.innerHTML = text;
      }

      if (user === 'david') {
        messageDiv.appendChild(img);
        messageDiv.appendChild(bubble);
      } else {
        messageDiv.appendChild(bubble);
        messageDiv.appendChild(img);
      }

      chat.appendChild(messageDiv);
    }

    // Typing indicator
    let typingDiv = null;
    function showTypingIndicator() {
      typingDiv = document.createElement('div');
      typingDiv.classList.add('message', 'david');
      typingDiv.innerHTML = `<img class="avatar" src="david.png" alt="David">
                             <div class="bubble typing-indicator">David is typing...</div>`;
      chat.appendChild(typingDiv);
      autoScroll();
    }

    function hideTypingIndicator() {
      if (typingDiv && chat.contains(typingDiv)) {
        chat.removeChild(typingDiv);
        typingDiv = null;
      }
    }

    // Handle enter key
    function handleKeyDown(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        sendMessage();
      }
    }

    // Auto-scroll to bottom if near bottom
    function autoScroll() {
      if (chat.scrollHeight - chat.scrollTop - chat.clientHeight < 50) {
        chat.scrollTop = chat.scrollHeight;
      }
    }

    // Nudge
    function nudge() {
      // Show "You have nudged David!"
      const infoDiv = document.createElement('div');
      infoDiv.classList.add('nudge-info');
      infoDiv.innerText = "You have nudged David!";
      chat.appendChild(infoDiv);

      // Play sound and shake
      const nudgeSound = document.getElementById('nudgeSound');
      nudgeSound.play();
      messenger.classList.add('nudging');
      setTimeout(() => messenger.classList.remove('nudging'), 500);

      // After a delay, David responds to nudge
      showTypingIndicator();
      setTimeout(() => {
        hideTypingIndicator();
        const reply = getDavidResponse('', true); // Nudge response
        addMessage('david', 'david.png', reply);
        autoScroll();
      }, 2000);

      autoScroll();
    }

    // Popups for emoticons and attach
    let currentPopup = null;
    function togglePopup(id) {
      const popup = document.getElementById(id);
      if (currentPopup && currentPopup !== popup) {
        currentPopup.style.display = 'none';
      }
      popup.style.display = popup.style.display === 'block' ? 'none' : 'block';
      currentPopup = popup.style.display === 'block' ? popup : null;
    }

    function insertEmoticon(imgEl) {
      const emoticonHTML = `<img src="${imgEl.src}" class="emoticon">`;
      const input = messageInput;
      // Insert at cursor position
      const start = input.selectionStart;
      const end = input.selectionEnd;
      const text = input.value;
      input.value = text.substring(0, start) + emoticonHTML + text.substring(end);
      input.focus();
      // Move cursor after inserted emoticon (approx)
      input.selectionStart = input.selectionEnd = start + emoticonHTML.length;
      hidePopups();
    }

    function sendAttachedImage(src) {
      addMessage('jacko', 'jacko.png', src, true);
      hidePopups();
      autoScroll();

      // Simulate David's response
      showTypingIndicator();
      setTimeout(() => {
        hideTypingIndicator();
        const reply = getDavidResponse('');
        addMessage('david', 'david.png', reply);
        autoScroll();
      }, 2000);
    }

    function hidePopups() {
      const popups = document.querySelectorAll('.popup');
      popups.forEach(p => p.style.display = 'none');
      currentPopup = null;
    }

    document.addEventListener('click', (e) => {
      if (currentPopup && !currentPopup.contains(e.target) && !e.target.classList.contains('icon-btn')) {
        hidePopups();
      }
    });

  </script>
</body>
</html>